<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

  
    
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Installing Nokogiri - Nokogiri 鋸</title>
    <meta name="author" content="Team Sparklemotion">
    
    <meta name="description" content="Documentation for Nokogiri, a Ruby XML and HTML library.">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="http://nokogiri.org/tutorials/installing_nokogiri.html">
    
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="" rel="alternate" title="Nokogiri 鋸" type="application/atom+xml">
  </head>


  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item one-fifth lap-four-sixths palm-one-whole">
  <a href="/" class="site-title">Nokogiri 鋸</a>
</div>

<div class="grid__item four-fifths lap-two-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-left">
  <li><a href="http://rdoc.info/github/sparklemotion/nokogiri" target="_blank">Docs</a></li>
  <li><a href="https://github.com/sparklemotion/nokogiri" target="_blank">GitHub</a></li>
</ul>
<ul class="menu pull-right">
  <li><a href="/tutorials/installing_nokogiri.html"><b>Installation</b></a></li>
  <li><a href="/tutorials/"><b>Tutorials</b></a></li>
  <li><a href="/tutorials/getting_help.html"><b>Getting Help</b></a></li>
</ul>

  </nav>
</div>


  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="page">

  <div class='clearfix'>
    

    
    <div class='pull-right'>
      <a href=/tutorials/parsing_an_html_xml_document.html>Parsing an HTML/XML document →</a>
    </div>
    
  </div>

  
  <header>
    <h1 class="title indent">
      Installing Nokogiri
    </h1>
  </header>
  

  <ol>
<li><a href="#ubuntu___debian">Ubuntu / Debian</a></li>
<li><a href="#freebsd">FreeBSD</a></li>
<li><a href="#openbsd">OpenBSD</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#red_hat___centos">Red Hat / CentOS</a></li>
<li><a href="#gnu_guix">GNU Guix</a></li>
<li><a href="#mac_os_x">Mac OS X</a></li>
<li><a href="#using_your_system_libraries">Using Your System Libraries</a></li>
<li><a href="#using_nonstandard_libxml2___libxslt_installations">Using Nonstandard libxml2 / libxslt installations</a></li>
<li><a href="#smartos__nonstandard_">SmartOS (Nonstandard)</a></li>
<li><a href="#other">Other</a></li>
</ol>


<hr class='divider'>


<h1>Installing Nokogiri</h1>

<p>Because Nokogiri needs to be <a href="http://en.wikipedia.org/wiki/Compiler">compiled</a> and <a href="http://en.wikipedia.org/wiki/Dynamic_linker">dynamically linked</a>
against both <a href="http://xmlsoft.org/index.html">libxml2</a> and <a href="http://xmlsoft.org/xslt/">libxslt</a>, it has gained a
reputation for being complicated to install.</p>

<p>As of Nokogiri 1.6, <code>libxml2</code> and <code>libxslt</code> source code is bundled
with Nokogiri, and compiled at gem-install-time. The instructions in
this document should work for all versions 1.6.4 and later.</p>

<p>(If you need support for installing earlier versions of Nokogiri, you
may want to take a look at the git history for <a href="https://github.com/sparklemotion/nokogiri.org-tutorials/blob/master/content/installing_nokogiri.md">this document</a>.)</p>

<p>Let&rsquo;s tackle each platform and scenario in ascending order of difficulty &hellip;</p>

<h2><span id='ubuntu___debian'> Ubuntu / Debian </span></h2>

<p>Installation should Just Work™ on Ubuntu and Debian using Nokogiri&rsquo;s
vendored <code>libxml2</code> and <code>libxslt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h3>Troubleshooting Ubuntu / Debian Installation</h3>

<p>If you have issues, first make sure you have all the tooling necessary
to compile C extensions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo apt-get install build-essential patch
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s possible that you don&rsquo;t have important development header files
installed on your system. (This has never happened to me personally,
but I have it on good authority that otherwise good and noble Ruby
developers run into this.) Here&rsquo;s what you should do if you should
find yourself in this situation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo apt-get install ruby-dev zlib1g-dev liblzma-dev
</span></code></pre></td></tr></table></div></figure>


<p>Please report it as a bug if this doesn&rsquo;t work for you (see
<a href="http://www.nokogiri.org/tutorials/getting_help.html">Getting Help</a> for details).</p>

<h3>Troubleshooting RVM-based Installation</h3>

<p>Some versions of RVM will install a Ruby binary that requires
libgmp. See <a href="https://github.com/rvm/rvm/issues/3509">https://github.com/rvm/rvm/issues/3509</a> for background.</p>

<p>So, if your <code>mkmf.log</code> file says:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/usr/bin/ld: cannot find -lgmp
</span></code></pre></td></tr></table></div></figure>


<p>then try this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo apt-get install libgmp-dev
</span></code></pre></td></tr></table></div></figure>


<p>Please report it as a bug if this doesn&rsquo;t work for you (see
<a href="http://www.nokogiri.org/tutorials/getting_help.html">Getting Help</a> for details).</p>

<h2><span id='freebsd'> FreeBSD </span></h2>

<p>Installation should Just Work™ on FreeBSD using Nokogiri&rsquo;s
vendored <code>libxml2</code> and <code>libxslt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h2><span id='openbsd'> OpenBSD </span></h2>

<p>Installation requires gcc from ports in order to compile
vendored <code>libxml2</code> and <code>libxslt</code>. Installing nokogiri should
Just Work™ using the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pkg_add -v gcc
</span><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h2><span id='windows'> Windows </span></h2>

<h3>Option 1: Precompiled DLLs (&ldquo;fat binary&rdquo;)</h3>

<p>Compiling on Windows requires the installation of special build tools,
and so as an alternative we provide a pre-compiled Nokogiri gem that
comes bundled with all the DLLs you need to be NOKOGIRIFIED!</p>

<p>Specifically, we publish gems specific for the Windows &ldquo;platform&rdquo;, as
it&rsquo;s called by Rubygems. For example, <a href="https://rubygems.org/gems/nokogiri/versions/1.6.5">Nokogiri 1.6.5</a> published:</p>

<ul>
<li><a href="https://rubygems.org/downloads/nokogiri-1.6.5-x64-mingw32.gem">nokogiri-1.6.5-x64-mingw32.gem</a></li>
<li><a href="https://rubygems.org/downloads/nokogiri-1.6.5-x86-mingw32.gem">nokogiri-1.6.5-x86-mingw32.gem</a></li>
</ul>


<p>for the 64-bit and 32-bit Rubyinstaller rubies, respectively.</p>

<p>This <strong>should</strong> Just Work™:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h3>Option 2: Native Windows compilation</h3>

<p>As of Nokogiri 1.6.7, <a href="http://rubyinstaller.org/add-ons/devkit/">DevKit</a> compilation of Nokogiri is fully
supported.</p>

<p>If you don&rsquo;t know what DevKit is, or if you&rsquo;re using an earlier
version of Nokogiri than 1.6.7, you should not try to follow this
process, and should instead install a gem with precompiled DLLs using
<strong>Option 1</strong> above.</p>

<h3>Troubleshooting Native Windows compilation</h3>

<p>If you see this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ERROR:  Error installing nokogiri:
</span><span class='line'>        The <span class="s1">&#39;nokogiri&#39;</span> native gem requires installed build tools.
</span><span class='line'>
</span><span class='line'>Please update your PATH to include build tools or download the DevKit
</span><span class='line'>from <span class="s1">&#39;http://rubyinstaller.org/downloads&#39;</span> and follow the instructions
</span><span class='line'>at <span class="s1">&#39;http://github.com/oneclick/rubyinstaller/wiki/Development-Kit&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>or you see something like this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Extracting libiconv-1.14.tar.gz into tmp/i686-pc-mingw32/ports/libiconv/1.14... OK
</span><span class='line'>Running <span class="s1">&#39;configure&#39;</span> <span class="k">for</span> libiconv 1.14... ERROR, review
</span><span class='line'><span class="s1">&#39;C:/RailsInstaller/.../nokogiri-1.6.5/.../libiconv/1.14/configure.log&#39;</span>
</span><span class='line'>to see what happened.
</span><span class='line'>*** extconf.rb failed ***
</span><span class='line'>Could not create Makefile due to some reason, probably lack of necessary
</span><span class='line'>libraries and/or headers.  Check the mkmf.log file <span class="k">for</span> more details.  You may
</span><span class='line'>need configuration options.
</span></code></pre></td></tr></table></div></figure>


<p>then you may be runing a buggy version of Rubygems that&rsquo;s not
downloading the appropriate gemfile for your platform (see
<a href="https://groups.google.com/d/msg/nokogiri-talk/BJiwiebHxoQ/B3vgV4iE9g0J">this thread</a> for background). <strong>Please update
to Rubygems 2.4.5 or later for the fix</strong>.</p>

<p>Please report it as a bug if this doesn&rsquo;t work for you (see
<a href="http://www.nokogiri.org/tutorials/getting_help.html">Getting Help</a> for details).</p>

<h2><span id='red_hat___centos'> Red Hat / CentOS </span></h2>

<p>The easiest way to get Nokogiri installed on CentOS and RHEL seems to be the
<a href="http://fedoraproject.org/wiki/EPEL">EPEL</a> repository which contains a prebuilt nokogiri package. To use it,
install the appropriate <a href="http://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages.3F">epel-release</a> package for your OS, then run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo yum install -y rubygem-nokogiri
</span></code></pre></td></tr></table></div></figure>


<p>However, installation of the regular gem should Just Work™ using
Nokogiri&rsquo;s vendored <code>libxml2</code> and <code>libxslt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h3>Troubleshooting Red Hat / CentOS Installation</h3>

<p>If you have issues, make sure you have some of the basic Ruby
developer tools that you&rsquo;ll need to compile the C extension,
<code>libxml2</code>, and <code>libxslt</code>:</p>

<p>It&rsquo;s also possible that you don&rsquo;t have the zlib development header
files installed on your system.</p>

<p>This has never happened to me personally, but I have it on good
authority that otherwise good and noble Ruby developers run into this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo yum install -y gcc ruby-devel zlib-devel
</span></code></pre></td></tr></table></div></figure>


<p>In newer versions of Fedora and Red Hat, you may see an error like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gcc: error: /usr/lib/rpm/redhat/redhat-hardened-cc1: File or directory doesn<span class="err">&#39;</span>t exists
</span></code></pre></td></tr></table></div></figure>


<p>in which case you&rsquo;ll also need rpm to build nokogiri:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo dnf install -y rpm-build
</span></code></pre></td></tr></table></div></figure>


<p>Please report it as a bug if this doesn&rsquo;t work for you (see
<a href="http://www.nokogiri.org/tutorials/getting_help.html">Getting Help</a> for details).</p>

<h2><span id='gnu_guix'> GNU Guix </span></h2>

<p><a href="https://www.gnu.org/software/guix/">GNU Guix</a> is a reproducible
binary software package management and distribution system that works
on <em>all</em> Linux distributions. Installing Nokogiri with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>guix package -i ruby-nokogiri
</span></code></pre></td></tr></table></div></figure>


<p>will install Nokogiri with tool and libraries and all its dependencies
(including a recent Ruby, libxml2 and libxslt). The source code for
the package can be found <a href="http://git.savannah.gnu.org/cgit/guix.git/tree/gnu/packages/ruby.scm">here</a>. A short description of how Nokogiri was packaged can be found
<a href="https://github.com/pjotrp/guix-notes/blob/master/RUBYGEMS-Nokogiri.org">here</a>.</p>

<h2><span id='mac_os_x'> Mac OS X </span></h2>

<p>Installation should Just Work™ using Nokogiri&rsquo;s vendored <code>libxml2</code> and <code>libxslt</code>.</p>

<p>First, make sure you have the latest version of RubyGems and xcode commandline tools:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem update --system
</span><span class='line'>xcode-select --install
</span></code></pre></td></tr></table></div></figure>


<p>Then install nokogiri:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<h3>Troubleshooting OSX Installation</h3>

<h4>Error Message About <code>libiconv</code> Missing</h4>

<p>If you get an error message saying that <code>libiconv</code> is missing, the fix is
ensuring that you have the right developer tools selected, or the license has
been accepted.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Building nokogiri using packaged libraries.
</span><span class='line'>checking <span class="k">for</span> iconv.h... yes
</span><span class='line'>checking <span class="k">for</span> iconv_open<span class="o">()</span> in iconv.h... no
</span><span class='line'>checking <span class="k">for</span> iconv_open<span class="o">()</span> in -liconv... no
</span><span class='line'>checking <span class="k">for</span> libiconv_open<span class="o">()</span> in iconv.h... no
</span><span class='line'>checking <span class="k">for</span> libiconv_open<span class="o">()</span> in -liconv... no
</span><span class='line'>-----
</span><span class='line'>libiconv is missing. please visit http://nokogiri.org/tutorials/installing_nokogiri.html <span class="k">for</span> <span class="nb">help </span>with installing dependencies.
</span><span class='line'>-----
</span><span class='line'>*** extconf.rb failed ***
</span></code></pre></td></tr></table></div></figure>


<p>The fix is really easy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>brew unlink gcc-4.2      <span class="c"># you might not need this step</span>
</span><span class='line'>gem uninstall nokogiri
</span><span class='line'>xcode-select --install
</span><span class='line'>gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<p>This is verified working on Mac OS X 10.9 w/ Xcode&rsquo;s clang compiler.</p>

<p>(Many thanks to @allaire and others for helping verify this!)</p>

<h5><code>xcode-select</code> errors with a &lsquo;network problem&rsquo;</h5>

<p>If, when you run the above commands, you see this dialog:</p>

<p><img src="../assets/xcode-select-network-problem.png" alt="xcode-select-network-problem" /></p>

<p>Then run this command to turn off forced-authentication with Apple Software
Update:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo defaults delete /Library/Preferences/com.apple.SoftwareUpdate CatalogURL
</span></code></pre></td></tr></table></div></figure>


<h4>Error Message About Undeclared Identifier <code>LZMA_OK</code></h4>

<p>A more recent error mentions an undeclared identifier <code>LZMA_OK</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>xmlIO.c:1450:52: error: use of undeclared identifier <span class="s1">&#39;LZMA_OK&#39;</span>
</span><span class='line'>    <span class="nv">ret</span> <span class="o">=</span>  <span class="o">(</span>__libxml2_xzclose<span class="o">((</span>xzFile<span class="o">)</span> context<span class="o">)</span> <span class="o">==</span> LZMA_OK <span class="o">)</span> ? <span class="m">0</span> : -1<span class="p">;</span>
</span><span class='line'>                                                   ^
</span><span class='line'><span class="m">1</span> error generated.
</span></code></pre></td></tr></table></div></figure>


<p>The solution for this is a little more subtle and can be fixed in a couple of
ways.</p>

<ol>
<li><p>For some people, the <code>xcode-select</code> solution presented under the
<a href="#error-message-about-libiconv-missing"><code>libiconv</code></a> issue above works.
Generally, this works only when Xcode or macOS has recently been upgraded
and the Xcode licence has not yet been accepted.</p></li>
<li><p>When using Homebrew, there are several libraries that use a formula called
<code>xz</code> (including <code>the_silver_searcher</code> and <code>imagemagick</code>), which by default
installs a version of <code>liblzma</code> that is incompatible with most Ruby builds.
(Homebrew installs only the 64-bit version of the library, but most Ruby
builds are universal.) This can be fixed in a couple of ways:</p>

<ol type="a">
<li><p>The most reliable way appears to be temporarily unlinking <code>xz</code> and
relinking it during an install of <code>nokogiri</code>:</p>

<pre><code class="sh">brew unlink xz
gem install nokogiri # or bundle install
brew link xz
</code></pre></li>
<li><p>The second way that has been reported having success is to install <code>xz</code>
as a universal build:</p>

<pre><code class="sh">brew reinstall xz --universal
</code></pre></li>
<li><p>The third way is to use a Homebrew-installed <code>libxml2</code>, as suggested in
<a href="#using-your-system-libraries">using your system libraries</a>.</p>

<pre><code class="sh">brew install libxml2
# If installing directly
gem install nokogiri -- --use-system-libraries \
  --with-xml2-include=$(brew --prefix libxml2)/include/libxml2
# If using Bundle
bundle config build.nokogiri --use-system-libraries \
  --with-xml2-include=$(brew --prefix libxml2)/include/libxml2
bundle install
</code></pre>

<p>When working with this, be certain to use <code>$(brew --prefix libxml2)</code>
because it will use the correct location for your Homebrew install.</p></li>
</ol>
</li>
</ol>


<h3>Other macOS Tips</h3>

<ul>
<li>Make sure ruby is compiled with the latest clang compiler.</li>
<li>Ruby is no longer dependent upon <code>gcc-4.2</code>.</li>
<li>Binary gems and ruby really should be compiled with the same
compiler/environment.</li>
<li>If you have multiple versions of Xcode installed, make sure you use the
right <code>xcode-select</code>.</li>
</ul>


<p>If you have any other issues, please report it as a bug (preferably a new one,
read <a href="http://www.nokogiri.org/tutorials/getting_help.html">Getting Help</a> for details) and pull in @zenspider.</p>

<h2><span id='using_your_system_libraries'> Using Your System Libraries </span></h2>

<p>If, instead of Nokogiri&rsquo;s vendored libraries, you&rsquo;d like to use your
system&rsquo;s <code>libxml2</code>, <code>libxslt</code> and related libraries, please first
understand that you may be asking Nokogiri to work with an unsupported
version of <code>libxml2</code>. We try hard to warn you about this; and will
even refuse to compile against some known-bad versions of <code>libxml2</code>.</p>

<p>But, we want to give you the flexibility to choose this option.</p>

<p>Here&rsquo;s how to use your installed system libraries instead of the
vendored libraries:</p>

<h3>Step 1: Make sure you have <code>pkg-config</code> installed</h3>

<p>Everything should Just Work™ if you have <code>pkg-config</code> installed.</p>

<p>On Debian/Ubuntu:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo apt-get install pkg-config
</span></code></pre></td></tr></table></div></figure>


<p>On FreeBSD:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo pkg install pkgconf
</span></code></pre></td></tr></table></div></figure>


<h3>Step 2: Build Nokogiri</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri -- --use-system-libraries
</span></code></pre></td></tr></table></div></figure>


<p>Or, if you&rsquo;re using Bundler:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bundle config build.nokogiri --use-system-libraries
</span><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<h3>Using Your System Libraries with Nokogiri >= 1.6.0, &lt; 1.6.2</h3>

<p>Nokogiri did not support the CLI argument <code>--use-system-libraries</code>
before v1.6.2. If you are trying to use system libraries with an
earlier version of Nokogiri, use the <code>NOKOGIRI_USE_SYSTEM_LIBRARIES</code>
environment variable instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">NOKOGIRI_USE_SYSTEM_LIBRARIES</span><span class="o">=</span><span class="m">1</span> gem install nokogiri
</span></code></pre></td></tr></table></div></figure>


<p>Or, if you&rsquo;re using Bundler:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">NOKOGIRI_USE_SYSTEM_LIBRARIES</span><span class="o">=</span>1
</span><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<h2><span id='using_nonstandard_libxml2___libxslt_installations'> Using Nonstandard libxml2 / libxslt installations </span></h2>

<p>If:</p>

<ul>
<li>you&rsquo;ve got libxml2 and/or libxslt installed in a nonstandard place,</li>
<li>and you don&rsquo;t have <code>pkg-config</code> installed</li>
</ul>


<p>you can use command-line parameters to the <code>gem install</code> command to
specify build parameters.</p>

<p>If you&rsquo;ve got the proper <code>config</code> scripts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri -- <span class="se">\</span>
</span><span class='line'>    --use-system-libraries <span class="se">\</span>
</span><span class='line'>    --with-xml2-config<span class="o">=</span>/path/to/xml2-config <span class="se">\</span>
</span><span class='line'>    --with-xslt-config<span class="o">=</span>/path/to/xslt-config
</span></code></pre></td></tr></table></div></figure>


<p>or, you can specify the installation root directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri -- <span class="se">\</span>
</span><span class='line'>    --use-system-libraries <span class="se">\</span>
</span><span class='line'>    --with-xml2-dir<span class="o">=</span>/path/to/dir <span class="se">\</span>
</span><span class='line'>    --with-xslt-dir<span class="o">=</span>/path/to/dir
</span></code></pre></td></tr></table></div></figure>


<p>or, you can specify include and library directories separately:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri -- <span class="se">\</span>
</span><span class='line'>    --use-system-libraries <span class="se">\</span>
</span><span class='line'>    --with-xml2-lib<span class="o">=</span>/path/to/builds/lib <span class="se">\</span>
</span><span class='line'>    --with-xml2-include<span class="o">=</span>/path/to/builds/include/libxml2 <span class="se">\</span>
</span><span class='line'>    --with-xslt-lib<span class="o">=</span>/path/to/builds/lib <span class="se">\</span>
</span><span class='line'>    --with-xslt-include<span class="o">=</span>/path/to/builds/include
</span></code></pre></td></tr></table></div></figure>


<p>N.B.: By default, libxslt header files are installed into the
root include directory, but libxml2 header files are installed into a
subdirectory thereof named <code>libxml2</code>.</p>

<p>It&rsquo;s likely that you&rsquo;ll also need to specify the location of your
<code>zlib</code> and <code>iconv</code> (and possibly <code>exslt</code>) install directories as
well. In that case, you can add the options:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install nokogiri -- <span class="se">\</span>
</span><span class='line'>    --use-system-libraries <span class="se">\</span>
</span><span class='line'>    <span class="c"># ...</span>
</span><span class='line'>    --with-iconv-dir<span class="o">=</span>/path/to/dir <span class="se">\</span>
</span><span class='line'>    --with-zlib-dir<span class="o">=</span>/path/to/dir <span class="se">\</span>
</span><span class='line'>    <span class="o">[</span>--with-exslt-dir<span class="o">=</span>/path/to/dir<span class="o">]</span>
</span><span class='line'>    <span class="o">[</span>--with-exslt-config<span class="o">=</span>/path/to/exslt-config<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>And how to tell Bundler to use custom parameters</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bundle config build.nokogiri <span class="se">\</span>
</span><span class='line'>       --use-system-libraries <span class="se">\</span>
</span><span class='line'>       --with-xml2-lib<span class="o">=</span>/usr/local/lib <span class="se">\</span>
</span><span class='line'>       --with-xml2-include<span class="o">=</span>/usr/local/include/libxml2/libxml <span class="se">\</span>
</span><span class='line'>       --with-xslt-lib<span class="o">=</span>/usr/local/lib <span class="se">\</span>
</span><span class='line'>       --with-xslt-include<span class="o">=</span>/usr/local/include/libxslt <span class="se">\</span>
</span><span class='line'>       --with-iconv-lib<span class="o">=</span>/usr/local/lib <span class="se">\</span>
</span><span class='line'>       --with-iconv-include<span class="o">=</span>/usr/local/include
</span></code></pre></td></tr></table></div></figure>


<p>Some versions of bundler have a bug (bundler/bundler#3053) that causes
the options to be sent improperly, resulting in a <code>Syntax error:
Unterminated quoted string</code> error.  The workaround is to edit your
<code>.bundle/config</code> file, remove the quotes around the options, and place
all the options on a single line.</p>

<h2><span id='smartos__nonstandard_'> SmartOS (Nonstandard) </span></h2>

<p>SmartOS installation requires building and using
libxml2/libxslt/libiconv in a nonstandard location. Building on the
previous section, here&rsquo;s how to do it:</p>

<p>(Note: <code>pkgsrc</code> is included in JPC SmartOS instances)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pkgin install ruby gcc49 libxml2 libxslt zlib libiconv ruby22-rake gmake
</span><span class='line'>ln -s /opt/local/gcc49/bin/gcc /opt/local/bin/gcc
</span><span class='line'>
</span><span class='line'>gem install nokogiri -- <span class="se">\</span>
</span><span class='line'>    --use-system-libraries <span class="se">\</span>
</span><span class='line'>    --with-xml2-lib<span class="o">=</span>/opt/local/lib <span class="se">\</span>
</span><span class='line'>    --with-xml2-include<span class="o">=</span>/opt/local/include/libxml2 <span class="se">\</span>
</span><span class='line'>    --with-xslt-lib<span class="o">=</span>/opt/local/lib <span class="se">\</span>
</span><span class='line'>    --with-xslt-include<span class="o">=</span>/opt/local/include/libxslt <span class="se">\</span>
</span><span class='line'>    --with-iconv-lib<span class="o">=</span>/opt/local/lib <span class="se">\</span>
</span><span class='line'>    --with-iconv-include<span class="o">=</span>/opt/local/include <span class="se">\</span>
</span><span class='line'>    --with-zlib-dir<span class="o">=</span>/opt/local/lib
</span></code></pre></td></tr></table></div></figure>


<p>See the previous section for guidance on how to instruct Bundler to
use these options.</p>

<h2><span id='other'> Other </span></h2>

<p>Don&rsquo;t see your platform here? We&rsquo;d love to add to this
document. Please feel free to send pull requests to
<a href="https://github.com/sparklemotion/nokogiri.org-tutorials">sparklemotion/nokogiri.org-tutorials</a>.</p>


  <div class='clearfix'>
    

    
    <div class='pull-right'>
      <a href=/tutorials/parsing_an_html_xml_document.html>Parsing an HTML/XML document →</a>
    </div>
    
  </div>

</article>


        </div>

        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <p class="copyright">
  <span class="pull-left">
    Contribute to these docs at <a href="//github.com/sparklemotion/nokogiri.org-tutorials">sparklemotion/nokogiri.org-tutorials</a>.
  </span>
  <span class="pull-right">
    Powered by <a href="//octopress.org/">Octopress</a>. Theme is <a href="//github.com/coogie/oscailte">Oscailte</a>.
  </span>
</p>

    </div>
  </div>
</div>

    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>







  </body>
</html>